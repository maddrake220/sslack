(self.webpackChunksslack=self.webpackChunksslack||[]).push([[256],{5256:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>b});var l=a(2309),n=a(2545),s=a(9250),o=a(8678),r=a(2951),i=a(8401);const c=(0,i.Z)("div",{target:"e11xbzz02"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),u=(0,i.Z)("header",{target:"e11xbzz01"})({name:"1ezwwi6",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& .header-right{display:flex;flex:1;justify-content:flex-end;align-items:center;}"}),d=(0,i.Z)("div",{target:"e11xbzz00"})({name:"czjct4",styles:"position:absolute;top:64px;left:0;width:100%;height:calc(100% - 64px);background:white;opacity:0.7;display:flex;align-items:center;justify-content:center;font-size:40px"});var h=a(3564),p=a(8667),f=a(9669),g=a.n(f),m=a(7294),v=a(5977),w=a(5723);const b=()=>{var e,t;const{workspace:a,channel:i}=(0,v.UO)(),{data:f}=(0,w.ZP)("/api/users",h.Z),[b,k,x]=(0,o.Z)(""),{data:C}=(0,w.ZP)(`/api/workspaces/${a}/channels/${i}`,h.Z),{data:Z,mutate:_,revalidate:E,setSize:T}=(0,w.g_)((e=>`/api/workspaces/${a}/channels/${i}/chats?perPage=20&page=${e+1}`),h.Z),{data:$}=(0,w.ZP)(f?`/api/workspaces/${a}/channels/${i}/members`:null,h.Z),[y]=(0,r.Z)(a),z=0===(null==Z||null===(e=Z[0])||void 0===e?void 0:e.length)||Z&&(null===(t=Z[Z.length-1])||void 0===t?void 0:t.length)<20||!1,S=(0,m.useRef)(null),[D,B]=(0,m.useState)(!1),[F,A]=(0,m.useState)(!1),I=(0,m.useCallback)((e=>{if(e.preventDefault(),console.log(b),null!=b&&b.trim()&&Z&&C){const e=b;_((t=>{var a;return null==t||t[0].unshift({id:((null===(a=Z[0][0])||void 0===a?void 0:a.id)||0)+1,content:e,UserId:f.id,User:f,ChannelId:C.id,Channel:C,createdAt:new Date}),t}),!1).then((()=>{var e;x(""),null===(e=S.current)||void 0===e||e.scrollToBottom()})),g().post(`/api/workspaces/${a}/channels/${i}/chats`,{content:b}).then((()=>{E()})).catch(console.error)}}),[b,Z,f,C,a,i]),P=(0,m.useCallback)((e=>{e.Channel.name!==i||!e.content.startsWith("uploads\\")&&e.UserId===(null==f?void 0:f.id)||_((t=>(null==t||t[0].unshift(e),t)),!1).then((()=>{var e;S.current&&S.current.getScrollHeight()<S.current.getClientHeight()+S.current.getScrollTop()+150&&(console.log("scrollToBottom!",null===(e=S.current)||void 0===e?void 0:e.getValues()),setTimeout((()=>{var e;null===(e=S.current)||void 0===e||e.scrollToBottom()}),50))}))}),[i,f]);(0,m.useEffect)((()=>(null==y||y.on("message",P),()=>{null==y||y.off("message",P)})),[y,P]),(0,m.useEffect)((()=>{1===(null==Z?void 0:Z.length)&&(console.log("toBottomWhenLoaded",S.current),setTimeout((()=>{var e;console.log("scrollbar",S.current),null===(e=S.current)||void 0===e||e.scrollToBottom()}),500))}),[Z]);const U=(0,m.useCallback)((()=>{B(!0)}),[]),j=(0,m.useCallback)((()=>{B(!1)}),[]),N=((0,m.useCallback)((e=>{const t=new FormData;if(e.target.files)for(let a=0;a<e.target.files.length;a++){const l=e.target.files[a].getAsFile();console.log("... file["+a+"].name = "+l.name),t.append("image",l)}g().post(`/api/workspaces/${a}/channels/${i}/images`,t).then((()=>{}))}),[]),(0,m.useCallback)((e=>{e.preventDefault(),console.log(e);const t=new FormData;if(e.dataTransfer.items){for(let a=0;a<e.dataTransfer.items.length;a++)if("file"===e.dataTransfer.items[a].kind){const l=e.dataTransfer.items[a].getAsFile();console.log(e,".... file["+a+"].name = "+l.name),t.append("image",l)}}else for(let a=0;a<e.dataTransfer.files.length;a++)console.log(e,"... file["+a+"].name = "+e.dataTransfer.files[a].name),t.append("image",e.dataTransfer.files[a]);g().post(`/api/workspaces/${a}/channels/${i}/images`,t).then((()=>{A(!1)}))}),[a,i])),H=(0,m.useCallback)((e=>{e.preventDefault(),console.log(e),A(!0)}),[]);if(!f||!f)return null;const M=(0,p.Z)(Z?Z.flat().reverse():[]);return m.createElement(c,{onDrop:N,onDragOver:H},m.createElement(u,null,m.createElement("span",null,"#",i),m.createElement("div",{className:"header-right"},m.createElement("span",null,null==$?void 0:$.length),m.createElement("button",{onClick:U,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip_parent",type:"button"},m.createElement("i",{className:"c-icon p-ia__view_header__button_icon c-icon--add-user","aria-hidden":"true"})))),m.createElement(n.Z,{chatSections:M,ref:S,setSize:T,isReachingEnd:z}),m.createElement(l.Z,{chat:b,onChangeChat:k,onSubmitForm:I}),m.createElement(s.Z,{show:D,onCloseModal:j,setShowInviteChannelModal:B}),F&&m.createElement(d,null,"업로드!"))}}}]);