(self.webpackChunksslack=self.webpackChunksslack||[]).push([[94],{3094:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>w});var n=l(7294),r=l(8401);const a=(0,r.Z)("div",{target:"e10g8mgq2"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),o=(0,r.Z)("header",{target:"e10g8mgq1"})({name:"1c17pcy",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& img{margin-right:5px;}"});(0,r.Z)("div",{target:"e10g8mgq0"})({name:"czjct4",styles:"position:absolute;top:64px;left:0;width:100%;height:calc(100% - 64px);background:white;opacity:0.7;display:flex;align-items:center;justify-content:center;font-size:40px"});var i=l(6182),s=l.n(i),c=l(5723),u=l(3564),d=l(5977),g=l(2309),h=l(2545),p=l(8678),m=l(9669),v=l.n(m),f=l(8667),x=l(2951);const w=function(){var e,t;const{workspace:l,id:r}=(0,d.UO)(),{data:i}=(0,c.ZP)(`/api/workspaces/${l}/users/${r}`,u.Z),{data:m}=(0,c.ZP)("/api/users",u.Z),[w,k,Z]=(0,p.Z)(""),[b]=(0,x.Z)(l),y=(0,n.useRef)(null),{data:S,mutate:E,revalidate:C,setSize:$}=(0,c.g_)((e=>`/api/workspaces/${l}/dms/${r}/chats?perPage=20&page=${e+1}`),u.Z),T=0===(null==S||null===(e=S[0])||void 0===e?void 0:e.length)||S&&(null===(t=S[S.length-1])||void 0===t?void 0:t.length)<20||!1,z=(0,n.useCallback)((e=>{if(e.preventDefault(),null!=w&&w.trim()&&S){const e=w;E((t=>{var l;return null==t||t[0].unshift({id:((null===(l=S[0][0])||void 0===l?void 0:l.id)||0)+1,content:e,SenderId:m.id,Sender:m,ReceiverId:i.id,Receiver:i,createdAt:new Date}),t}),!1).then((()=>{var e;Z(""),null===(e=y.current)||void 0===e||e.scrollToBottom()})),v().post(`/api/workspaces/${l}/dms/${r}/chats`,{content:w}).then((()=>{Z("")})).catch((e=>{console.dir(e),C()}))}}),[w,S,m,i,l,r]),B=(0,n.useCallback)((e=>{e.SenderId===Number(r)&&m.id!==Number(r)&&E((t=>(null==t||t[0].unshift(e),t)),!1).then((()=>{var e;y.current&&y.current.getScrollHeight()<y.current.getClientHeight()+y.current.getScrollHeight()+150&&(console.log("scrollToBottom!",null===(e=y.current)||void 0===e?void 0:e.getValues()),setTimeout((()=>{var e;null===(e=y.current)||void 0===e||e.scrollToBottom()}),50))}))}),[]);if((0,n.useEffect)((()=>(null==b||b.on("dm",B),()=>{null==b||b.on("dm",B)})),[b,r,m]),(0,n.useEffect)((()=>{var e;1===(null==S?void 0:S.length)&&(null===(e=y.current)||void 0===e||e.scrollToBottom())}),[S]),!i||!m)return null;const R=(0,f.Z)(S?S.flat().reverse():[]);return console.log("chatDataLists == > ",null==S?void 0:S.flat().reverse()),n.createElement(a,null,n.createElement(o,null,n.createElement("img",{src:s().url(i.email,{s:"24px",d:"retro"}),alt:i.nickname})),n.createElement(h.Z,{chatSections:R,ref:y,setSize:$,isReachingEnd:T}),n.createElement(g.Z,{chat:w,onChangeChat:k,onSubmitForm:z}))}}}]);